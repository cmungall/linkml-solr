# linkml-solr

A simple wrapper for using Solr with [LinkML](https://linkml.io) schemas

This provides a convenience layer for working with a Solr database
whose schema is defined in LinkML. It provides bindings both from
slots in your schema to queries, and binds result objects to your
object model.

```python
from tests.test_models.books import *
from linkml_solr import SolrQueryEngine, SolrEndpoint
...
schema = YAMLGenerator(schemafile).schema
qe = SolrQueryEngine(schema=schema,
                     endpoint=SolrEndpoint(url='http://localhost:8983/solr/books'))

result = qe.search(target_class=Book, genre_s='scifi')
for book in result.items:
    print(f'Book:  {book.name} :: {book}')
```

Unlike querying with the native pysolr API, this will validate input
keys (which your IDE will be aware of), and will instantiate an
instance of your model class.

 - validate query inputs (also IDE-aware)
 - instantiate classes in your object model
 - provide mappings from abstracted domain model concepts

## Step 1: Define your datamodel

See [tests/test_models/books.yaml](tests/test_models/books.yaml) for an example schema

(this schema was autogenerated from the [Books schema](https://github.com/geneontology/books/tree/master/metadata)

## Step 2: Create Python dataclasses

```bash
pipenv run gen-python myschema.yaml > myschema.py
```

See [tests/test_models/books.py](tests/test_models/books.py) for an example

## Step 3: Code

See [tests/test_query.py](tests/test_query.py) for an example

## Command Line Tools

### main command

```
lsolr-bulkload --help
Usage: lsolr-bulkload [OPTIONS] COMMAND [ARGS]...

  Main

  Args:

      verbose (int): Verbose.     quiet (bool): Quiet.

  Returns:

      None.

Options:
  -v, --verbose
  -q, --quiet TEXT
  --help            Show this message and exit.

Commands:
  bulkload       Convert multiple golr yaml schemas to linkml :param files:...
  create-schema
  start-server
```

### bulkload

```
lsolr-bulkload bulkload --help
Usage: lsolr-bulkload bulkload [OPTIONS] [FILES]...

  Convert multiple golr yaml schemas to linkml :param files: :param schema:
  :return:

Options:
  -s, --schema TEXT  Path to schema.
  -C, --core TEXT    solr core.
  -f, --format TEXT  input format.
  -u, --url TEXT     solr url.
  --help             Show this message and exit.
```

## More documentation

More documentation coming soon. For now, consult the tests.

## Appendix

### Converting from Golr schemas to LinkML

See the Makefile:

```Makefile
tests/test_models/amigo.yaml: linkml_solr/utils/golr_schema_utils.py
	pipenv run python $< tests/test_golr/*yaml > $@
```

## TODOs

Alpha code. Functionality is very incomplete

 - write
 - customizable dynamic mapping
 - automatic de-nesting/de-normalization
 - autogen of model-specific API
 - expose additional solr functionality
